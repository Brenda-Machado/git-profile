#!/usr/bin/env python3
import subprocess
import sys
from configparser import ConfigParser
from pathlib import Path

config = ConfigParser()
config.read(Path.home() / ".gitprofile")

def usage():
    print("usage: git profile <command> [parameters]")
    print("  list           List available profiles")
    print("  use <profile>  Set active profile")
    sys.exit(1)

if len(sys.argv) < 2:
    usage()

cmd = sys.argv[1]

if cmd == "list":
    for profile in config.sections():
        print(f"  {profile}")

elif cmd == "use":
    if len(sys.argv) < 3:
        usage()
    
    profile = sys.argv[2]
    if not config.has_section(profile):
        print(f"Profile '{profile}' not found")
        sys.exit(1)
    
    name = config.get(profile, "name")
    email = config.get(profile, "email")
    
    subprocess.run(["git", "config", "--local", "user.name", name], check=True)
    subprocess.run(["git", "config", "--local", "user.email", email], check=True)
    print(f"Set user to {name} <{email}>")

else:
    print(f"Unknown command: {cmd}")
    usage()
